<html>
    <head>
    <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <style>
        td:hover{
            cursor:pointer;
        }
        img:hover{
            cursor:pointer;
        }
        #bubble{
            position:relative;
            overflow:hidden;
            transition: height linear 0.25s;
            height:0px;
            width:225px;
            background-color:skyblue;
        }
        #response{
            padding:10px;
            position:absolute;
            font-size:20px;
        }
        #clickable-table{
            position:absolute;
        }
        #ok-continue{
            cursor:pointer;
        }
        .blurred{
            -webkit-filter: blur(5px);
            -moz-filter: blur(5px);
            -o-filter: blur(5px);
            -ms-filter: blur(5px);
            filter: blur(5px);
            pointer-events:none;
        }
    </style>
    </head>
    <body>
        <div id="inputparameters">
            
            <label for="latInput">Latitude:</label>
            <input value="50.457725" id="latInput" type="number">
            <label for="lngInput">Longitude:</label>
            <input value="-104.622960" id="lngInput" type="number">
            <br>
            <img id="morty" src="icons/morty48.png">
                Click me!
            <br>
            <div id="bubble">
                <div id="response">
                    <div id="response-text"></div>
                    <br>
                    <div id="ok-continue" hidden>OK!</div>
                </div>
                
                <table id="clickable-table">
                    <thead>
                        <tr>
                        <th>&nbsp;</th>
                        <th>Location Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001001.svg" height="25"></td><td>Pedestrian friendly</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001002.svg" height="25"></td><td>Cycling friendly</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001003.svg" height="25"></td><td>Transit friendly</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001024.svg" height="25"></td><td>Car friendly</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001009.svg" height="25"></td><td>Parks</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001014.svg" height="25"></td><td>Groceries</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001018.svg" height="25"></td><td>Shopping</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001016.svg" height="25"></td><td>Nightlife</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001015.svg" height="25"></td><td>Restaurants</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001017.svg" height="25"></td><td>Cafes</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001019.svg" height="25"></td><td>Daycares</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001020.svg" height="25"></td><td>Primary Schools</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001021.svg" height="25"></td><td>High Schools</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001006.svg" height="25"></td><td>Quiet</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001023.svg" height="25"></td><td>Green</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001012.svg" height="25"></td><td>Historic</td></tr>
                        <tr><td><img src="https://cdn.locallogic.co/icons-svg/i9001013.svg" height="25"></td><td>Vibrant</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <script>
             var includes = ["pedestrian_friendly", "cycling_friendly", "transit_friendly",
                    "car_friendly", "parks", "groceries", "shopping", "nightlife", "restaurants", 
                    "cafes", "daycares", "primary_schools", "high_schools", "quiet", "green", "historic",
                    "vibrant"];
            var json;
            var open = false;
            
            $(function(){
                $("tr").click(function(){
                    $("#response-text").html('<i class="fas fa-spinner"></i>');
                    var index = $("#clickable-table tr").index(this) - 1;
                    var lat = $("#latInput").val();
                    var lng = $("#lngInput").val();
                    var response = getInformation(lat, lng, index);
                    $("#response-text").html(response);
                    $("#clickable-table").addClass("blurred");
                    $("#clickable-table").prop("disabled", true);
                    $("#ok-continue").show();
                })
                $("#morty").click(function(){
                    if(open) $("#bubble").css("height", "0px");
                    else $("#bubble").css("height", "580px");
                    open = !open;
                })
                $(document).click(function(event){
                    console.log((event.target).closest("#bubble"));
                    if($(event.target).closest("#bubble")[0] == null && open && $(event.target).closest("#morty")[0] == null){
                        console.log("closed");
                        $("#bubble").css("height", "0px");
                        open = false;
                    }
                })
                $("#ok-continue").click(function(){
                    $("#clickable-table").removeClass("blurred");
                    $("#clickable-table").prop("disabled", false);
                    $("#ok-continue").hide();
                    $("#response-text").html("");
                })
            })
            
            function getInformation(lat, lng, index){
                var accessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4ZjdlNWI1ZmMyZDIzYzhhNDg0NTY2YjExNDBiZGNlMzk0YzYxYTZiMTI3ZTg5MDI3NDM0ZGRmYjlhNjFkNWM2NmIxMDZkZDY2YmNmM2EwMiIsImJvdW5kcyI6eyJzdyI6WzQ4Ljk5LC0xMDkuOTldLCJuZSI6WzYwLC0xMDEuMzZdfSwiaWF0IjoxNTM5MTg0NzYzLCJleHAiOjE1Mzk3MDMxNjN9.PmW6d83eG-rCJdcVAvwwq6b6sBQMwPk6s0uolHgn1ws";
                var url = "https://api.locallogic.co/v1/scores";
                var scoreName = includes[index];
                var jsonResponse;
                console.log("lat: " + lat + ", lng: " + lng + " score: " + scoreName); 
                $.ajax({
                    async:false,
                    url: url,
                    type: 'GET',
                    data: {
                        lat: lat,
                        lng: lng,
                        access_token: accessToken,
                        include: scoreName,
                    },
                    dataType: 'json',
                    success: function(data){
                        if(data.data != null && data.data.attributes[scoreName] != null){
                            jsonResponse = data.data.attributes[scoreName].text;
                            console.log(jsonResponse);
                        }
                        else {
                            jsonResponse = "Sorry, we couldn't find any information about this topic :(";
                        }
                    }
                })
                return jsonResponse;
            }
        </script>
    </body>
</html>
